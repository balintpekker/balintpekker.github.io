{"componentChunkName":"component---src-templates-blog-post-js","path":"/ai-code-review/","result":{"data":{"site":{"siteMetadata":{"title":"bPekker.dev"}},"markdownRemark":{"id":"4098ef97-1c0f-55e2-8dad-8eff60be0b98","excerpt":"It’s been a while since I’ve posted here. The last few months were packed with projects — shipping features, handling migrations, managing infrastructure, and…","html":"<p>It’s been a while since I’ve posted here. The last few months were packed with projects — shipping features, handling migrations, managing infrastructure, and everything in between. Writing fell by the wayside. But recently, something clicked again.</p>\n<p>Dries’ recent post on coding with Claude sparked a familiar feeling: curiosity, a bit of wonder, and the urge to build and share again.\r\nIt got me thinking. Not just about AI, but about how much of our work could be smoother — how we can build better systems not only for users, but\r\nfor ourselves. That post was a quiet nudge to return to sharing, building in public, and refining the tools we rely on daily.</p>\n<p>And it reminded me of something I’ve been tinkering with quietly in my own stack: smarter automation around code review.</p>\n<blockquote>\n<p><a href=\"#get-it-running\">TL;DR; - Jump to the 'How to' section</a></p>\n</blockquote>\n<h3 id=\"one-small-pr-for-a-drupal-developer-a-giant-leap\">One small PR for a Drupal Developer, a giant leap...</h3>\n<p>In a previous post, I set up GitHub Actions to handle deprecation checks, unit tests, and code sniffing in pull requests, using a lightweight Drupal template repository as the foundation. <a href=\"https://github.com/balintpekker/drupal-template/pull/5\">Here's a small pull request</a> in that repository — almost insignificant by itself.</p>\n<p>But it's not about what the PR changes. It's about <strong>who reviewed it: a bot.</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ed849d92a11698dafa9ee02adb69303/dc333/pr_comment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVR42pVT247TMBDt//8GX4DEOx+Aqm27JV0gvVCaprk7iW+x4xzGDqsFxBbtREczY8VnJnMmi+VyidVqjWkChBDQWsNYC2PMDIrv2TiOUEpBSglrDRZRFGG3e4JUA6qaoeMCXCiCDGcexo6vYjAWQunwvh6I0FexVKUsK5R1g5p1aLs+kA7m5dI9Uju6X37EYqJvtZQwxtCwBiK0fv8zXzPPtXgO/Ax8l3XTBPK6queuqxkDzfNNhJwE8WS+S9a2gZRzHgpJGrpz7m2EmobfMw7eSXQdR9v2GDSpPFhYmqUbp//DEeGEKbCXmuFTucVj9Q3n6gfi8oxjk+Dc33DhGXLTIPMY/o10qMEMfyGM1Rnv2Ae8bz4i6p6wLjfYsM9YNTEe2i9Yia/Y6hiROSCyB+z+wtbGSMZsVtnbrc6xPG6QigKlaFAJhpLTTGWPbpBgA+3nqKCgIScN4dQf4E5COT3P0JuUCmmSIrvlAWVRzXGWo6H9ZCRYRapXpH7LWvCeBwj6ESTtrPd+/WZRCI46Hf3WtxyKKxhlYEkQ7wcSzMPHhoRy1s2XfgcdBVGeVfZnXVvgtF/i+3GLffyA02WHw2GD6+ERp3iNM+VpecS1OCDxyPe4ZDHK5oK+z2lX9XOH9FCFnmaU6By5rnCVBVJVkM9R6RoZ5YnMkIgMV5GH8+ApL0jl1nEYZ/ETJFk3goI1NroAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"\"\n        src=\"/static/5ed849d92a11698dafa9ee02adb69303/f058b/pr_comment.png\"\n        srcset=\"/static/5ed849d92a11698dafa9ee02adb69303/c26ae/pr_comment.png 158w,\n/static/5ed849d92a11698dafa9ee02adb69303/6bdcf/pr_comment.png 315w,\n/static/5ed849d92a11698dafa9ee02adb69303/f058b/pr_comment.png 630w,\n/static/5ed849d92a11698dafa9ee02adb69303/dc333/pr_comment.png 938w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The comments weren't written by a teammate, or even by me. It was generated automatically by a lightweight review bot I'm experimenting with. And the potential here is exciting!</p>\n<p>Code reviews are essential — we all know that. But in practice, they’re often rushed, skipped, or inconsistent. On fast-paced projects, especially in smaller teams, review sometimes becomes a checkbox rather than a true quality gate.</p>\n<p>What if we could offload some of the tedious or obvious review steps to an automated system? Not to replace human input, but to augment it — to ensure consistency, catch regressions, and raise the floor on quality.</p>\n<h3 id=\"what-could-an-ai-drupal-review-bot-do\">What could an AI Drupal Review Bot Do?</h3>\n<p>We’ve had bots helping with code reviews for a while now — things like <code class=\"language-text\">phpcs</code>, <code class=\"language-text\">phpstan</code>, <code class=\"language-text\">drupal-check</code>, and similar tools integrated into CI pipelines. They’re great at catching the obvious: coding standard violations, deprecated function calls, missing docblocks, or unsafe patterns. But they’re static. They follow strict rules and can’t think beyond what they’re explicitly told to look for.</p>\n<p>AI-powered bots like Claude, on the other hand, introduce a new layer — one that can reason about code structure, spot logic issues, suggest architectural improvements, or even ask thoughtful questions about intent. It’s not just validation; it’s interpretation.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5fba6586c782babda0dfd97eaa7da86f/44fd6/inline_review.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.949367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2UlEQVR42oWP3WrDMAyF8/6PtpttV6GENrR1U48ui/yfOHbOZJewm8IEH0eyhHTctG2LqxAgIiil4cMM5z2c88g5o8S2bfgvymxiGiklHuMI0hpTWcqqjamqWI21tdase6/MKv3slTfPBvbDTbkdXYD9JjgyWG2opBCR/My6VLaYnizrH3HXBKwZObHDsnm4tTgd39ipQNe9o2cO/Se60weEOKLj/CwP/IMbSA0vmUggzIYXssWv+IPLcseUDK5WQoYRvRI1f3jCxdxxNgPGSKBsXjJljTkv+AUs8n/Ss8xa4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img_2.png\"\n        title=\"\"\n        src=\"/static/5fba6586c782babda0dfd97eaa7da86f/f058b/inline_review.png\"\n        srcset=\"/static/5fba6586c782babda0dfd97eaa7da86f/c26ae/inline_review.png 158w,\n/static/5fba6586c782babda0dfd97eaa7da86f/6bdcf/inline_review.png 315w,\n/static/5fba6586c782babda0dfd97eaa7da86f/f058b/inline_review.png 630w,\n/static/5fba6586c782babda0dfd97eaa7da86f/44fd6/inline_review.png 789w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here are a few <strong>examples</strong> Claude can do that static tools can’t:</p>\n<ul>\n<li>Suggest architectural improvements, like replacing procedural code with service-based approaches.</li>\n<li>Flag readability or complexity issues, offering suggestions to simplify long methods or nested conditions.</li>\n<li>Ask reviewer-style questions, like “What happens if the user doesn’t have access here?” — something only a human (or an AI trained to think like one) would notice.</li>\n<li>Static tools don’t care if your variable name says “profile” but it’s actually storing a company ID. Claude can call that out based on code semantics.</li>\n<li>While static tools can validate syntax in <code class=\"language-text\">services.yml</code>, they won’t understand why a tag might be missing or unnecessary. Claude can interpret intent and suggest better alternatives.</li>\n</ul>\n<p>... and I'm sure there are many more.</p>\n<h3 id=\"get-it-running\">Get It Running</h3>\n<p>The foundation for this experiment comes from the excellent <a href=\"https://github.com/TurboKach/ai-reviewer\">ai-reviewer</a> GitHub Action by TurboKach. Out of the box, it’s designed to run Claude reviews on pull requests, analyzing the diff and leaving contextual comments as if a human reviewer had stepped in. It supports Anthropic’s Claude models (among others) and is remarkably easy to drop into a CI pipeline.</p>\n<h4 id=\"what-youll-need\">What you'll need</h4>\n<ol>\n<li>\n<p>You’ll need an Anthropic API key to use Claude, and once you have it, you can store it securely in your repo settings as a GitHub secret, usually under <code class=\"language-text\">ANTHROPIC_API_KEY</code>.</p>\n</li>\n<li>\n<p>A <a href=\"https://github.com/balintpekker/drupal-template/blob/main/.github/scripts/pr_review.py\">python script</a> that does the job for us.</p>\n</li>\n<li>\n<p>The <a href=\"https://github.com/balintpekker/drupal-template/blob/main/.github/workflows/code_review.yml\">GitHub workflow file</a>: <code class=\"language-text\">.github/workflows/pr-review.yml</code> with the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> AI PR Review (Claude with Inline Comments)\r\n\r\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>opened<span class=\"token punctuation\">,</span> synchronize<span class=\"token punctuation\">,</span> reopened<span class=\"token punctuation\">]</span>\r\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span>\r\n\r\n<span class=\"token key atrule\">permissions</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">contents</span><span class=\"token punctuation\">:</span> read\r\n  <span class=\"token key atrule\">pull-requests</span><span class=\"token punctuation\">:</span> write\r\n\r\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">ai_review</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\r\n\r\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout PR code\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Python\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>python@v4\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">python-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.11'</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install dependencies\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pip install anthropic PyGithub\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run Claude AI Reviewer\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">ANTHROPIC_API_KEY</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ANTHROPIC_API_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token comment\"># Customize file filtering here</span>\r\n          <span class=\"token key atrule\">PR_REVIEW_WHITELIST</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'**/*.php,**/*.module,**/*.install,**/*.theme,**/*.twig,**/*.yml,**/*.yaml'</span>\r\n          <span class=\"token key atrule\">PR_REVIEW_BLACKLIST</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'**/vendor/**,**/core/**,**/contrib/**,**/node_modules/**,**/dist/**,**/bin/**,**/web/libraries/**,**/sites/default/files/**'</span>\r\n          <span class=\"token key atrule\">PR_REVIEW_MODEL</span><span class=\"token punctuation\">:</span> claude<span class=\"token punctuation\">-</span>3<span class=\"token punctuation\">-</span>5<span class=\"token punctuation\">-</span>haiku<span class=\"token punctuation\">-</span><span class=\"token number\">20240307</span>  <span class=\"token comment\"># or 20241022 if you prefer</span>\r\n          <span class=\"token key atrule\">PR_REVIEW_MAX_TOKENS</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3000'</span>\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> python .github/scripts/pr_review.py\r\n</code></pre></div>\n</li>\n</ol>\n<p>To make it more Drupal-aware, I made a few changes:</p>\n<ul>\n<li>Tweaked the file ignore patterns (<code class=\"language-text\">PR_REVIEW_BLACKLIST</code>) to skip core and contrib files amongst others while still catching custom module logic and YAML configurations.</li>\n<li>Limited review scope (<code class=\"language-text\">PR_REVIEW_BLACKLIST</code>) to the most relevant file types for Drupal custom development.</li>\n</ul>\n<h3 id=\"how-much-is-the-fish\">How much is the fish?</h3>\n<p>Claude charges per token, and token usage depends on the size of the files and the review context. For reference:</p>\n<ul>\n<li>Reviewing a single small PHP file (~ 150 lines) typically costs <strong>$0.01–$0.03</strong> depending on the model used (claude-3-opus being the most advanced, and most expensive).</li>\n<li>A full PR with multiple files might run up to <strong>$0.10–$0.25</strong>.</li>\n</ul>\n<p>However, you can configure the action to limit token usage or model scope, which is especially helpful if you want to run it only on larger PRs or in specific repos. That means you can feasibly add AI review to your dev workflow without breaking the budget — especially when compared to the value of catching a subtle bug before it ships.</p>\n<h3 id=\"thoughts\">Thoughts</h3>\n<p>While this is still early experimentation (at least for me), it's already clear that AI-assisted code review can bring real value — especially in fast-paced projects where every bit of automation helps. I'm not saying tools like Claude can replace human reviewers, but they do raise the quality by catching small things, asking smart questions, and giving us developers more time to focus on the parts that truly require human insight.</p>","frontmatter":{"title":"AI Code Review for Drupal","date":"April 10, 2025","description":"It’s been a while since I’ve posted here. The last few months were packed with projects — shipping features, handling migrations, managing infrastructure, and everything in between. Writing fell by the wayside. But recently, something clicked again. Dries’ recent post on coding with Claude sparked a familiar feeling: curiosity, a bit of wonder, and the urge to build and share again."},"fields":{"slug":"/ai-code-review/","readingTime":{"text":"6 min read"}}},"previous":{"fields":{"slug":"/drupal-11/"},"frontmatter":{"title":"Drupal 11 is at the doorstep"}},"next":null},"pageContext":{"id":"4098ef97-1c0f-55e2-8dad-8eff60be0b98","previousPostId":"d45e0696-f47c-5ec2-b412-060cc683dab0","nextPostId":null}},"staticQueryHashes":["2155073650","3257411868","3514747643"],"slicesMap":{}}