{"componentChunkName":"component---src-templates-blog-post-js","path":"/to-patch-or-not-to-patch/","result":{"data":{"site":{"siteMetadata":{"title":"bPekker.dev"}},"markdownRemark":{"id":"0886debe-4d16-54ca-81cd-ba7e8feec7e6","excerpt":"There is an ongoing debate among developers regarding the use of patches versus pull requests for contributions. Since its migration to GitLab in 2018, Drupal…","html":"<p>There is an ongoing debate among developers regarding the use of patches versus pull requests for contributions. Since its migration to GitLab in 2018, Drupal has undergone significant changes. As of July 2024, the removal of Drupal CI and automated patch testing could potentially change the way contributions are made.</p>\n<blockquote>\n<p><a href=\"#patches-vs-pull-requests\">TL;DR; - Jump to the 'Patches vs. Pull Requests' section</a></p>\n</blockquote>\n<h3 id=\"transitioning-of-testing-platforms\">Transitioning of testing platforms</h3>\n<h4 id=\"understanding-the-change\">Understanding the change</h4>\n<p>In July 2023, Gitlab CI was enabled for all contrib projects on Drupal.org, allowing users to use both Drupal CI and the new platform. The recommendation was to disable the old configurations to free up resources, and a guide on <a href=\"https://www.drupal.org/docs/develop/git/using-gitlab-to-contribute-to-drupal/gitlab-ci\">how to get started with GitLab CI</a> was also posted to help project maintainers.</p>\n<p>Drupal announced in October 2023 that <a href=\"https://www.drupal.org/about/core/blog/drupal-cores-gitlab-ci-testing-is-now-five-times-faster-than-drupalci\">testing core is five times faster</a> on the new platform than it was before. Also, a series of adjustments and refactors occurred, contributing to the overall optimization of the testing process resulting in the <strong>Drupal core on-commit and regression testing movement to GitLab CI.</strong> This move not only showcased the capabilities of the new platform, but also affirmed its viability.</p>\n<p>As a result, projects will no longer have the option to add Drupal CI configurations if they haven't already been configured prior to February 2024, and direct access to log outputs and artifacts will no longer be available.</p>\n<p>These developments mark a decisive step towards the ultimate decision slated for <strong>July 2024: the discontinuation of Drupal CI test runs</strong>, which leads to the point of this post: to patch or not to patch.</p>\n<h4 id=\"what-happens-with-patches\">What happens with patches?</h4>\n<p>While patches will continue to be available in the issue queues, the absence of test runs and testing results (from 2025) raises concerns about reliability and compatibility.</p>\n<p>This means <strong>the currently configured patches served from the issue queues will still work</strong>, but for new patches (and possibly even existing ones) Drupal engineers must exercise caution and manual testing in the future — or other quality assurance measures — to mitigate potential hazards as GitLab CI cannot test patch files.</p>\n<h3 id=\"patches-vs-pull-requests\">Patches vs. Pull Requests?</h3>\n<p>To be honest, each approach comes with its own set of advantages and challenges, and both are commonly used in the open-source community.</p>\n<p>The primary method for contributing to Drupal projects was by submitting patches for over 20 years. One significant advantage of this approach is the static nature of the patch file, allowing direct referencing in a site's <code class=\"language-text\">composer.json</code>. As projects are updated to newer versions, the community typically re-rolls the patch until the issue is ultimately resolved, ensuring users have access to updated versions that can be seamlessly integrated into their site. <em>(A common scenario here is when a project is updated in composer.json, and the patch applied previously becomes incompatible with the new version.)</em></p>\n<p>The Pull Request approach and GitLab does not have this functionality <strong>yet</strong>. Currently, it's possible to obtain a diff or patch file for an entire pull request changeset from GitLab by appending the <code class=\"language-text\">.diff</code> or <code class=\"language-text\">.patch</code> extension. However, this method is not immune to changes over time. This means, if a site uses continuous deployment where composer install is regularly executed (and the Pull Request on GitLab is updated with changes), unexpected issues could arise, not to mention that it is a <strong>security risk</strong>.</p>\n<p>While it's possible to mitigate this risk by downloading the changeset provided by GitLab at the specific time when the change is needed, it raises the question: how does this differ from utilizing the patch files?</p>\n<ul>\n<li>\n<p>The first part of the answer probably lies in the enhanced visibility of changes within a pull request compared to navigating through patches (and interdiffs). Pull requests offer a more streamlined and productive means of collaboration, particularly when engaging with multiple contributors.</p>\n</li>\n<li>\n<p>The second part is <strong>since patches won't get test runs anymore</strong> (or at least not with Drupal CI)<strong>, project maintainers may favor pull requests over patches when evaluating contributions in the future</strong>, and Drupal.org plans to <a href=\"https://www.drupal.org/project/drupalorg/issues/3295357\">migrate the current issues to GitLab issues</a> which has the potential to eliminate the need for patch files in the long run.</p>\n</li>\n</ul>\n<blockquote>\n<p>Side note: To address this, GitLab needs to merge the <a href=\"https://gitlab.com/gitlab-org/gitlab/-/issues/217206\">related pull request</a> that could resolve the problem of ever-changing diffs.</p>\n</blockquote>\n<h5 id=\"how-to-apply-pull-requests-to-a-site\">How to apply pull requests to a site?</h5>\n<p>The statement above does not necessarily imply that you should start adding pull requests to your site immediately. On the contrary, <strong>you should never reference a pull request patch file</strong> (until GitLab resolves the issue by allowing <code class=\"language-text\">.patch</code> to be appended to any compare URL) <strong>as its content can change as commits are pushed</strong>.</p>\n<p>If a project's issue doesn't require patches and solely relies on merging and testing on GitLab, you could append the <code class=\"language-text\">.patch</code> extension to the pull request, then <strong>download the file and use it in Composer from a local directory</strong>, or just use the UI to download the diff.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/679569147751e02b3f728d76afed39b2/105d8/download_patch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVR42pVRXW/CMAzs//8L+y8T0qQ9TjxVkG4gbcAooS0p+WjiJDc3aDwO7STrbDlx7pxKSomuHzAMF3RdD6VGWGthjUaMhEfI+cbN0WBRd6he3hqs1g3EWkCId2w2W9Rii2X9gb0ccfUZ1jnoKUIbC8f5L0II0NrwVMKr6PH0/Inq+6xYkcM0TXyAirrCnuB8RIiZlSbElEExch7vA+d7bXuCPMlSz73q63iGVLYUKSUQ3TgRITP/Ba01drt9WRPxoz7wQKMv3FDwPuC/GMcrDoeW1+BhjCtRzVbLJ7D8xLZyfhyzg5m996xOsSu6xw9qgdIpiwQ7KQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"download_patch.png\"\n        title=\"\"\n        src=\"/static/679569147751e02b3f728d76afed39b2/f058b/download_patch.png\"\n        srcset=\"/static/679569147751e02b3f728d76afed39b2/c26ae/download_patch.png 158w,\n/static/679569147751e02b3f728d76afed39b2/6bdcf/download_patch.png 315w,\n/static/679569147751e02b3f728d76afed39b2/f058b/download_patch.png 630w,\n/static/679569147751e02b3f728d76afed39b2/40601/download_patch.png 945w,\n/static/679569147751e02b3f728d76afed39b2/105d8/download_patch.png 1170w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"the-answer\">The Answer</h3>\n<p>Based on the above, the approach moving forward would involve using pull requests on GitLab for enhanced visibility and testing changes. Additionally, we will utilize patches based on the pull request changes, effectively employing both concurrently.</p>\n<h3 id=\"thoughts\">Thoughts</h3>\n<p>I look forward to the day when GitLab's capabilities for patches between any two references become accessible, and the need for downloading and storing local copies of patch files becomes unnecessary. Also, I want to urge contributors to familiarize themselves with GitLab ahead of the migration of the Drupal.org issue queue, as pull requests are inevitable.</p>","frontmatter":{"title":"To Patch or Not To Patch","date":"February 08, 2024","description":"There is an ongoing debate among developers regarding the use of patches versus pull requests for contributions. Since its migration to GitLab in 2018, Drupal has undergone significant changes. As of July 2024, the removal of Drupal CI and automated patch testing could potentially change the way contributions are made."},"fields":{"slug":"/to-patch-or-not-to-patch/","readingTime":{"text":"5 min read"}}},"previous":{"fields":{"slug":"/access-policy-api/"},"frontmatter":{"title":"Access Policy API"}},"next":{"fields":{"slug":"/drupal-recipes/"},"frontmatter":{"title":"The Drupal Prep Manual: Recipes!"}}},"pageContext":{"id":"0886debe-4d16-54ca-81cd-ba7e8feec7e6","previousPostId":"1c5e49e5-2777-5486-afca-728253e9f021","nextPostId":"622f8d7f-d869-573a-b21a-4d16db93efaf"}},"staticQueryHashes":["2155073650","3257411868","3514747643"],"slicesMap":{}}